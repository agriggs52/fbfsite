<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>User Profile - Frame by Frame</title>
<style>
  body {
    font-family: 'Lato', sans-serif;
    background: #69155f;
    margin: 20px;
    color: white;
  }
  h1 {
    font-family: 'Merriweather', serif;
    color: white;
  }
  .status-section {
    margin-bottom: 30px;
  }
  .comic-list {
    list-style: none;
    padding-left: 0;
  }
  .comic-list li {
    background: #611358;
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 6px;
  }
  a {
    color: #71b2f7;
    text-decoration: none;
    font-weight: 600;
  }
  a:hover {
    text-decoration: underline;
  }
  #backBtn {
    display: inline-block;
    margin-bottom: 20px;
    background: #f67e7d;
    padding: 8px 12px;
    border-radius: 4px;
    color: white;
    text-decoration: none;
    font-weight: bold;
  }
  #backBtn:hover {
    background: #d95c5d;
  }
    .review-box {
    margin-top: 10px;
    background-color: #4a0f45;
    padding: 10px;
    border-radius: 6px;
    display: none;
  }
  .star-rating {
    display: flex;
    flex-direction: row-reverse;
    font-size: 1.5em;
    justify-content: flex-start;
    gap: 5px;
  }
  .star-rating input {
    display: none;
  }
  .star-rating label {
    color: #ccc;
    cursor: pointer;
  }
  .star-rating input:checked ~ label,
  .star-rating label:hover,
  .star-rating label:hover ~ label {
    color: gold;
  }
  .comic-list li {
    cursor: pointer;
    position: relative;
    transition: color 0.3s;
  }
  .comic-list li:hover {
  color: #f67e7d; 
  text-decoration: underline;
}
  textarea {
    width: 100%;
    height: 80px;
    border-radius: 5px;
    border: none;
    padding: 8px;
    font-family: inherit;
    font-size: 1em;
    resize: vertical;
  }
  .save-review {
    margin-top: 8px;
    background: #2ca456;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
  }
.remove-review {
    margin-top: 8px;
    background: #f75858;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
  }
</style>
</head>
<body>
  <a href="index.html" id="backBtn">← Back to Comics</a>
  <h1>Your Profile</h1>
  <div id="profileContent">
   </div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const profileContent = document.getElementById('profileContent');
    const currentUser = localStorage.getItem('currentUser');

    if (!currentUser) {
      profileContent.innerHTML = '<p>You must be logged in to view this page.</p>';
      return;
    }

    const comics = [
      "New X-Men",
      "Absolute Batman",
      "Nightwing",
      "Saga",
      "Daredevil Born Again",
      "Watchmen",
      "Invincible",
      "The Nice House on the Lake",
      "Paper Girls",
      "Scott Pilgrim vs the World",
      "Ultimate Spiderman",
      "House of X/Powers of X Chronological Edition",
      "The Walking Dead",
      "Runaways",
      "Absolute Evil",
      "Moonknight",
      "Doctor Strange: The Oath",
      "Absolute Superman",
      "Absolute Wonderwoman",
      "Fantastic Four",
      "Uncanny Xmen",
      "Psylocke",
      "Hellboy",
      "W0RLDTR33",
      "Black Magick",
      "Wytches",
      "Ultimate Xmen",
      "Exceptional Xmen"
    ];

    const statuses = {
      'current': 'Current Read',
      'to-read': 'To Read',
      'did-not-finish': 'Did Not Finish'
    };

    const comicsByStatus = {
      'current': [],
      'to-read': [],
      'did-not-finish': []
    };

    comics.forEach(title => {
      const status = localStorage.getItem(`comicStatus_${title}`);
      if (status && comicsByStatus[status]) {
        comicsByStatus[status].push(title);
      }
    });

    let html = '';

    for (const [statusKey, statusName] of Object.entries(statuses)) {
      const comicList = comicsByStatus[statusKey];
      html += `<div class="status-section">
        <h2>${statusName} (${comicList.length})</h2>`;
      if (comicList.length === 0) {
        html += '<p>No comics marked in this category.</p>';
      } else {
        html += '<ul class="comic-list">';
        comicList.forEach(title => {
          const savedRating = localStorage.getItem(`rating_${title}`) || 0;
          const savedReview = localStorage.getItem(`review_${title}`) || '';
          html += `
            <li data-title="${title}">
              ${title}
              <div class="review-box">
                <div class="star-rating">
                  ${[5,4,3,2,1].map(n => `
                    <input type="radio" id="${title}-star${n}" name="rating-${title}" value="${n}" ${n == savedRating ? 'checked' : ''}>
                    <label for="${title}-star${n}">★</label>
                  `).join('')}
                </div>
                <textarea placeholder="Write your review...">${savedReview}</textarea>
                <button class="save-review">Save Review</button>
                <button class="remove-review">Remove Review</button>
              </div>
            </li>`;
        });
        html += '</ul>';
      }
      html += '</div>';
    }

    profileContent.innerHTML = html;

     document.querySelectorAll('.comic-list li').forEach(li => {
      li.addEventListener('click', (e) => {
        if (
          e.target.tagName.toLowerCase() === 'label' ||
          e.target.classList.contains('save-review') ||
          e.target.classList.contains('remove-review') ||
          e.target.tagName.toLowerCase() === 'textarea'
        ) return;
        const reviewBox = li.querySelector('.review-box');
        reviewBox.style.display = (reviewBox.style.display === 'block') ? 'none' : 'block';
      });
    });

     document.querySelectorAll('.save-review').forEach(button => {
      button.addEventListener('click', (e) => {
        const li = e.target.closest('li');
        const title = li.getAttribute('data-title');
        const rating = li.querySelector('input[name="rating-' + title + '"]:checked')?.value || 0;
        const review = li.querySelector('textarea').value.trim();

        localStorage.setItem(`rating_${title}`, rating);
        localStorage.setItem(`review_${title}`, review);

        alert('Review saved for "' + title + '"!');
      });
    });

    document.querySelectorAll('.remove-review').forEach(button => {
      button.addEventListener('click', (e) => {
        const li = e.target.closest('li');
        const title = li.getAttribute('data-title');

         localStorage.removeItem(`rating_${title}`);
        localStorage.removeItem(`review_${title}`);

         li.querySelectorAll('input[type="radio"]').forEach(input => input.checked = false);
        li.querySelector('textarea').value = '';

        alert(`Review removed for "${title}".`);
      });
    });

  });
</script>

</body>
</html>